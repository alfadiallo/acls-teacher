<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACLS Teacher</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f4;
        }
        #output {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ccc;
            background: #fff;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>ACLS Teacher (Voice Interaction)</h1>
    <p>Click the button and start speaking to begin your ACLS quiz!</p>
    <button id="start-btn">üéôÔ∏è Start Quiz</button>
    <div id="output">Your conversation will appear here...</div>

    <script>
        // Speech-to-Text: Web Speech API
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        // Text-to-Speech: SpeechSynthesis API
        function speak(text) {
            const synth = window.speechSynthesis;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            synth.speak(utterance);
        }

        // OpenAI API Call
        async function getGPTResponse(userInput) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer 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`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [
                        { role: 'system', content: 'You are an ACLS Teacher. Quiz users on Adult Cardiac Arrest, Adult Tachycardia With a Pulse, and Adult Bradycardia algorithms.' },
                        { role: 'user', content: userInput }
                    ]
                })
            });
            const data = await response.json();
            return data.choices[0].message.content;
        }

        // Start Quiz Button
        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('output').innerText = 'Listening...';
            recognition.start();
        });

        // When Speech Recognition Captures Speech
        recognition.onresult = async function(event) {
            const userSpeech = event.results[0][0].transcript;
            document.getElementById('output').innerText = `You: ${userSpeech}`;
            speak('Let me think...');

            // Get GPT Response
            const gptResponse = await getGPTResponse(userSpeech);
            document.getElementById('output').innerText += `\nACLS Teacher: ${gptResponse}`;
            speak(gptResponse);
        };

        recognition.onerror = function(event) {
            console.error(event.error);
            document.getElementById('output').innerText = 'Error: ' + event.error;
        };
    </script>
</body>
</html>
